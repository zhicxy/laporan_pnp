<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Laporan PNP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

  </head>
  <body>
    <button type="button" class="btn btn-primary" onclick="simulasiNilai()">Simulasi</button>

    <div id="main-container"class="container-sm">
        
        <div class="card">
            <div class="card-header">
                <h5 class="text-center">Laporan Operasional UP Sengkang Blok 2</h5>
            </div>
 
            <div class="card-body">
                <h6>Hari, Tanggal : <span id="tanggal">Date</span></h6>
                <div class="input-group mb-3">
                    <span class="input-group-text">Pukul</span>
                    <select class="form-select" id="jam-selector">
                        <option value="0" selected disabled>---</option>
                        <option value="06:00">06:00</option>
                        <option value="16:00">16:00</option>
                        <option value="17:00">17:00</option>
                        <option value="18:00">18:00</option>
                    </select>
                    <span class="input-group-text">WITA</span>
                </div>
            </div>
        </div>
        
        
        <!-- card beban -->
        <form action="" class="needs-validation" novalidate>
        <div class="acordion acordion-flush id="accordionFlushExample">
        <div class="card acordion-item">
            <div class="card-header">
                <p>Beban</p>
            </div>
            <div class="card-body">
                <div class="input-group mb-3">
                    <span class="input-group-text">GT21</span>
                    <input type="text" class="form-control" id="gt-21-value" required>
                    <span class="input-group-text">MW</span>
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text">GT22</span>
                    <input type="text" class="form-control" id="gt-22-value" data-bs-toggle="tooltip" data-bs-title="Try using TAB to move between input text field" required>
                    <span class="input-group-text">MW</span>
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text">ST28</span>
                    <input type="text" class="form-control" id="st-28-value" required>
                    <span class="input-group-text">MW</span>
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text">Total Beban</span>
                    <input type="text" class="form-control" id="total-beban-value" required>
                    <span class="input-group-text">MW</span>
                </div>
            </div>
        </div>
        </div>


      <!-- card agc -->
      <div class="card">
            <div class="card-header">
                <p>AGC</p>
            </div>
            <div class="card-body" id="agc-card">
                <div class="input-group mb-3">
                    <span class="input-group-text text-label">Vacuum</span>
                    <input type="text" class="form-control" id="vacum-value" required>
                    <span class="input-group-text">BARA</span>
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text text-label">Pemakaian Sendiri</span>
                    <input type="text" class="form-control" id="ps-value" required>
                    <span class="input-group-text">MW</span>
                </div>

                <!-- total produksi -->
                <div class="input-group mb-3" id="total-produksi-div">
                    <span class="input-group-text text-label">Total Produksi</span>
                    <input type="text" class="form-control" id="total-produksi-value" required>
                    <span class="input-group-text">GWH</span>
                </div>
                
                <div class="d-flex justify-content center">
                    <div class="input-group mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" id="agc21" value="AGC 21">
                            <label class="form-check-label" for="agc21" id="agc21-label">AGC 21 OFF</label>
                        </div>
                    </div>
                    <div class="input-group mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" id="agc22" value="AGC 22">
                            <label class="form-check-label" for="agc22" id="agc22-label">AGC 22 OFF</label>
                        </div>
                    </div>
                </div>
                </div>
            </div>


        <!-- card gas -->
      <div class="card">
        <div class="card-header">
            <p>Suplai Gas</p>
        </div>
            <div class="card-body">
                <div class="input-group mb-3">
                    <span class="input-group-text text-label">GT21 + Blok1</span>
                    <input type="text" class="form-control" id="suplai-blok1-value" required>
                    <span class="input-group-text">MMSCFD</span>
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text text-label">GT22</span>
                    <input type="text" class="form-control" id="suplai-gt-22-value" required>
                    <span class="input-group-text">MMSCFD</span>
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text text-label">Pressure NG 21</span>
                    <input type="text" class="form-control" id="pressure-gas-21-value" required>
                    <span class="input-group-text">BAR</span>
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text text-label">Pressure NG 22</span>
                    <input type="text" class="form-control" id="pressure-gas-22-value" required>
                    <span class="input-group-text">BAR</span>
                </div>
            </div>
         </div>
        </form>
        <div id="button-container">
            <button type="button" class="btn btn-dark" id="button-generate" >Copy Laporan</button>
            <!-- <button type="button" class="btn btn-outline-dark" onclick="copy()">Copy</button> -->
        </div>

        <div id="report-area" class="form-floating" >
            <textarea class="form-control" id="floatingTextarea"></textarea>
            <label for="floatingTextarea">Your Report Here</label>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  </body>
  <style>
    body{
        background-color: rgb(199, 199, 199);
    }
    #main-container{
        margin-top: 50px;
        margin-bottom: 50px;
        width: 30%;
    }
    .card{
        margin-top: 20px;
    }

    .form-check{
        margin-right: 50px;
    }

    #button-container{
        margin-top: 20px;
        margin-bottom: 20px;
    }
    .text-label{
        width: 170px;
    }

    #report-area{
        display: none;
    }
    #floatingTextarea{
        height: 550px;
    }
   
  </style>
  <script>  

    // denfine class for element as parent
    class Input {
        constructor(elementID){
            this.id = '#' + elementID;
            this.element = document.querySelector(this.id);
        }
        getNilai(){
            console.log(this.element.value);
        }
    }

    // define classfrom input type text
    class Data extends Input {
        constructor(elementID, label, unit){
            super(elementID);
            this.label = this.element.previousElementSibling.innerHTML;
            this.unit = this.element.nextElementSibling.innerHTML;
        }

        getNilai(){
           return this.element.value;
        }
        getTextLine(){
            return this.label + ' : ' + this.getNilai() + ' ' + this.unit + '\n';
        }
        setNilai(angka){
            this.element.value = angka;
        }

    }
    class TotalProduksi extends Data{
        constructor(elementID, label, unit, jamDipilih){
            super(elementID, label, unit);
        }
        hideDiv(){
            this.element.parentElement.style.display = 'none';
        }
        showDiv(){
            this.element.parentElement.style.display = 'flex';
        }
    }

    //define class from toggle 
    class Toggle extends Input {
        constructor(elementID, label){
            super(elementID);
            this.label = this.element.nextElementSibling.innerHTML;
            this.element.addEventListener('click', ()=>{
                switch (this.element.checked){
                    case true:
                        this.label = this.element.value + ' ON';
                        break;
                        case false:
                            this.label = this.element.value + ' OFF';
                            break;
                        }
                        this.element.nextElementSibling.innerHTML = this.label;
                    })
        }
    }

    //define class from dropdown select
    class Select extends Input{
        constructor(elementID, label, unit, dipilih){
            super(elementID);
            this.label = 'Pukul : '
            this.unit = 'WITA'
            this.dipilih = this.element.value;

            // this.element.addEventListener('change', ()=>{
            //     this.dipilih = this.element.value;
            // });
            
        }
    }

        class mTanggal extends Input{
        constructor(elementID, laporan, sekarang, kemarin){
            super(elementID);
            this.date = new Date()
        }

        getTanggalKemarin(){
            return (this.date.getDate()-1)+ ' '
                    + this.getBulan() + ' '
                    + this.date.getFullYear(); 
        }
        getTanggalSekarang(){
            return this.getHari() + ', ' 
                    + this.date.getDate() + ' '
                    + this.getBulan() + ' '
                    + this.date.getFullYear(); 
        }

        getHari(){
            let hari = this.date.getDay();

            switch (hari){case 0: hari = 'Minggu'; break;
                            case 1: hari = 'Senin';break;
                            case 2: hari = 'Selasa';break;
                            case 3: hari = 'Rabu';break;
                            case 4: hari = 'Kamis';break;
                            case 5: hari = 'Jumat';break;
                            case 6: hari = 'Sabtu';}
            

            return hari;
        }

        getBulan(){
            let bulan = this.date.getMonth();
            switch (bulan){ case 0: bulan = 'Januari'; break;
                            case 1: bulan = 'Februari'; break;
                            case 2: bulan = 'Maret'; break;
                            case 3: bulan = 'April'; break;
                            case 4: bulan = 'Mei'; break;
                            case 5: bulan = 'Juni'; break;
                            case 6: bulan = 'Juli'; break;
                            case 7: bulan = 'Agustus'; break;
                            case 8: bulan = 'September'; break;
                            case 9: bulan = 'Oktober'; break;
                            case 10: bulan = 'November'; break;
                            case 11: bulan = 'Desember'; break;}
            return bulan;

        }
        setTanggalLaporan(){
            this.element.innerHTML = this.getTanggalSekarang()
        }
        
   }
    
    //enable tooltips from bootstrap
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

    // create object instance
    const jam = new Select('jam-selector');
    const bebanGt21 = new Data('gt-21-value');
    const bebanGt22 = new Data('gt-22-value');
    const bebanST28 = new Data('st-28-value');
    const totalBeban = new Data('total-beban-value');
    const vacum = new Data('vacum-value');
    const ps = new Data('ps-value');
    const totalProduksi = new Data('total-produksi-value');
    const suplaiBlok1 = new Data('suplai-blok1-value');
    const suplaiGt22 = new Data('suplai-gt-22-value');
    const pressureGas21 = new Data('pressure-gas-21-value');
    const pressureGas22 = new Data('pressure-gas-22-value');
    const agc21 = new Toggle('agc21');
    const agc22 = new Toggle('agc22');

    const s = new TotalProduksi('total-produksi-value');

    const tgl = new mTanggal('tanggal');
    tgl.setTanggalLaporan();


    let reportArea = document.querySelector('#report-area');
    let buatLaporan = document.querySelector('#button-generate');
    let divTotalProduksi = document.querySelector('#total-produksi-div');
    let area = document.querySelector('#floatingTextarea');

    function getTime(){
       return (jam.dipilih + ' WITA')
    }

    function toggleTotalProduksiDiv(){
        if (jam.dipilih == '06:00'){
            console.log('6');
        }else{
            console.log('7');

        }
    }

    function addDivTotalProduski(){
        divTotalProduksi.style.visibility='visible';
    }

    function removeDivTotalProduski(){
        divTotalProduksi.style.visibility='hidden';
    }

    function showReportArea(){
        reportArea.style.display = 'flex';
    }


    function dateFormat(tgl){
        let hari = tanggal.getDay();
        let bulan = tanggal.getMonth();
        let tahun = tanggal.getFullYear();
        
        switch (hari){case 0: hari = 'Minggu'; break;
        case 1: hari = 'Senin';break;
        case 2: hari = 'Selasa';break;
        case 3: hari = 'Rabu';break;
        case 4: hari = 'Kamis';break;
                      case 5: hari = 'Jumat';break;
                      case 6: hari = 'Sabtu';}
                      
        switch (bulan){ case 0: bulan = 'Januari'; break;
                        case 1: bulan = 'Februari'; break;
                        case 2: bulan = 'Maret'; break;
                        case 3: bulan = 'April'; break;
                        case 4: bulan = 'Mei'; break;
                        case 5: bulan = 'Juni'; break;
                        case 6: bulan = 'Juli'; break;
                        case 7: bulan = 'Agustus'; break;
                        case 8: bulan = 'September'; break;
                        case 9: bulan = 'Oktober'; break;
                        case 10: bulan = 'November'; break;
                        case 11: bulan = 'Desember'; break;}
                        
                        return hari+', '+tgl+' '+ bulan +' '+tahun;
    }

    function copy(){
        // copy content if visible
        if (reportArea.style.display == 'flex'){
            area.select();
            area.setSelectionRange(0, 99999);
            document.execCommand('copy');
            alert('Berhasil copy laporan');

        }else{
            alert('Buat Report dahulu atau periksa data anda jika belum lengkap');
        }
        // location.reload();
    }
    

    buatLaporan.addEventListener('click', ()=>{
        const forms = document.querySelectorAll('.needs-validation')

        // validate jam
        if (jam.dipilih == 0){
            alert ('Format jam tidak sesuai!');
        }else{
            // validate all Input text field
            // Loop over them and prevent submission
            Array.from(forms).forEach(form => {
                if (!form.checkValidity()) {
                    alert('Periksa Kembali. Data belum lengkap!');
                    reportArea.style.display = 'none';
                }else{
        showReportArea();
        area.innerHTML = buatText(getTime());
        copy();
                }
                form.classList.add('was-validated')
            }, false)


        }
    })

    function buatText(jamDipilih){
        let text1 ='Laporan Produksi UP Sengkang Blok 2' + '\n\n'
                + 'Hari, Tanggal : '+tgl.getTanggalSekarang() +'\n'
                + 'Pukul : '+getTime() +'\n\n'
                + bebanGt21.getTextLine()
                + bebanGt22.getTextLine()
                + bebanST28.getTextLine()
                + totalBeban.getTextLine() + '\n'
                + vacum.getTextLine()
                + ps.getTextLine() + '\n'

        let text2 = agc21.label + '\n'
                    + agc22.label + '\n\n'
                    + 'Supply Gas ' + '\n'
                    + suplaiBlok1.getTextLine()
                    + suplaiGt22.getTextLine() + '\n'
                    + pressureGas21.getTextLine()
                    + pressureGas22.getTextLine()

        if (jamDipilih=='06:00 WITA'){

            return text = text1 
                            + totalProduksi.label +' tgl '
                            + tgl.getTanggalKemarin() + ' : ' 
                            + totalProduksi.getNilai() + ' ' 
                            + totalProduksi.unit + '\n\n' 
                            + text2
        }else{
            return text = text1+ text2
        }
    }

    // hanya untuk pengetesan input nilai. this function must never called 
    function simulasiNilai(){
       bebanGt21.setNilai(1)
       bebanGt22.setNilai(2)
       bebanST28.setNilai(3)
       totalBeban.setNilai(4)
       vacum.setNilai(5)
       ps.setNilai(6)
       totalProduksi.setNilai(7)
       
       suplaiBlok1.setNilai(8)
       suplaiGt22.setNilai(9)
       pressureGas21.setNilai(10)
       pressureGas22.setNilai(11)
    }
    
            jam.element.addEventListener('change', ()=>{
                jam.dipilih = jam.element.value;
                if (jam.dipilih == '06:00'){
                    s.showDiv()
                }else{
                    s.hideDiv()
                }
            });
 
  </script>
</html>

<!-- fokus reposisi text area -->
